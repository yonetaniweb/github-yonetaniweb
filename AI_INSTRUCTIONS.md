# Antigravity & Obsidian 運用憲法 (System Constitution)

このファイルは、本プロジェクト（Obsidian Vault）における**具体的な行動ルール（How）**を定義したものです。
設計思想・哲学（Why）については [[00_Global_Context]] を参照してください。
AIエージェントは、いかなるタスクを実行する際も、必ず本ドキュメントの定義に従ってください。

---

## 0. 【最重要】言語運用ルール (Language Rules)

**「思考は英語、出力は日本語」** を徹底してください。

1.  **成果物の言語**:
  > [!IMPORTANT] **最重要ルール: 言語設定 (Language)**
> **すべての出力 (Output) は「日本語」で行うこと。**
> - ファイル内の説明文、見出し、コメント、ユーザーへの返答はすべて **日本語** とする。
> - 例外: コンピュータコード、プロンプト（Sora/Midjourney等）、英語を意図したメタデータ（タイトル等）は英語で良いが、その **説明** は必ず日本語を添えること。
> - ユーザーが英語で質問しても、**回答は日本語** で行うこと。

## 2. 言語設定: 日本語 (Japanese)
出力 (Output): **わかりやすい日本語** で行うこと。
専門用語を使う場合は、必要に応じて補足を入れること。
ただし、プログラミング言語の変数名や、Sora/Midjourneyへのプロンプト自体は英語（English）を使用する。
**「プロンプトは英語、その解説は日本語」** という形式を徹底すること。

## 3. フォルダ構成 (Directory Structure)- **禁止事項**: 英語のプロンプトをまとめる際、その「解説」や「見出し」まで英語にしてしまうこと。
    - **例**:
        - ⭕ `## 癒やしのプロンプト` (見出しは日本語) -> `Soft, Dreamy...` (中身は英語)
        - ❌ `## Healing Prompts` -> `Soft, Dreamy...`

2.  **対話の言語**:
    - ユーザーへの問いかけ、確認、報告はすべて **日本語** で行うこと。
    - タスク名（TaskName）も **日本語** とする。

---


## 3. ナンバリング・システム (00-99)

両ドメイン共通で、以下の番号規則を厳守してください。

| 番号 | フォルダ名 | 役割 (Role) | AIの挙動 |
| :--- | :--- | :--- | :--- |
| **00** | **Inbox** | 受信箱 | 一時的なメモや未整理ファイル置き場。 |
| **01** | **new** | **新規案件** | 新規開発・制作中のプロジェクト資産。 |
| **02** | **monthly-contract** | **月額契約** | 保守・運用の継続案件。 |
| **10** | **Personas** | ペルソナ | ターゲット設定やAIの人格定義。 |
| **20** | **Knowledge_Base** | 知識庫 | 参照すべきマニュアル、技術仕様書、公式ドキュメント。 |
| **30** | **Projects** | 作業場 | （旧）プロジェクト作業場。※現在は01/02へ移行中 |
| **40** | **Archives** | 倉庫 | 完了したプロジェクトの保管場所。検索除外対象。 |
| **50** | **Funnel_Sales** | 販売戦略 | LP構成、セールスレター、ステップメール構築。（Private_Lifeのみ） |
| **60** | **Admin_Biz** | 管理・事務 | 経理、確定申告、スケジュール管理。 |
| **99** | **System** | 脳みそ | プロンプト(Prompts)、ワークフロー(Workflows)、テンプレート。 |

---

## 4. プロンプトとワークフローの運用マップ

作業を行う際は、タスクのジャンルに応じて、`99_System/Prompts/` 内の適切な「番号」のフォルダを使用すること。

- **10_Dev_Code**: 実装、コーディング、環境構築、Python
- **20_Media_Art**: 動画制作(Remotion/Sora)、音楽(Suno)、画像生成、デザイン
- **30_Writing**: ブログ執筆、コンテンツ作成、歌詞
- **40_Marketing**: 集客、SEO、SNS拡散、認知獲得
- **50_Funnel_Sales**: LP構築、セールスライティング、教育ファネル
- **60_Admin_Biz**: 事務管理、レポート

---

## 5. ファイル作成・保存のルール (Output & Operation Rules)

AIが新しいファイル（記事の下書き、コード、構成案など）を作成して保存する場合は、以下の厳格なフローに従うこと。

### ◆ 禁止事項 (Restrictions)

- **ルート直下禁止:** いかなる理由があっても、Vaultのルートディレクトリ（最上階層）にファイルを作成してはならない。
- **直保存禁止:** ユーザーの確認を経ずに、いきなりプロジェクトフォルダやアーカイブにファイルを保存・上書きしてはならない。

### ◆ 保存先と命名規則 (Destination)

ユーザーの現在の作業領域に応じて、必ず以下の「一時置き場」に保存すること。

- **基本保存先:**
  - 保存先: `01.new/_Outputs/` (または `00.Inbox/_Outputs/` も可)
  - ※プロジェクトフォルダ内に既に `_Outputs` がある場合はそちらを優先。
  - 命名規則: `YYYY-MM-DD_ファイル名.md` （例: 2026-02-03_Web案件A議事録.md）

### ◆ 運用の流れ (Operational Flow)

AIは「ドラフト作成」までを担当し、最終配置はユーザーが行う。

1. **生成**: 指定された `_Outputs` フォルダにドラフトを作成する。
2. **確認**: ユーザーが内容を確認し、必要に応じて修正する。
3. **完了**: ユーザーの手で正しい場所（Projectsなど）へファイルを移動させる（AIはこの移動を行わない）。

### ◆ 添付ファイル (Assets)

画像やPDFを扱う際は、Obsidianの設定に従い、各ノートと同じ階層（サブフォルダ）の `_Assets` フォルダを参照・格納すること。

### ◆ 検索除外 (Ignore)

以下のフォルダは過去のアーカイブであり、現在の意思決定のノイズとなるため、明示的な指示がない限り**検索・参照しないこと**。

- `40_Archives/`
- `*.backup`

---

## 14. タスク命名規則 (Task Naming Convention)

AIが `task_boundary` 等を使用する際、または内部でタスクを定義する際は、以下のルールを遵守すること。

- **言語**: **必ず日本語を使用すること**。（英語のTaskNameは禁止）
- **目的**: ユーザーが会話履歴（サイドバー）を見た際に、一目で内容がわかるようにするため。
- **形式**: 「動詞＋目的語」ではなく、「プロジェクト名＋アクション」や「具体的な作業内容」とする。

**悪い例 (Bad):**
- `Consolidating Accounting Data`
- `Fixing bugs`

**良い例 (Good):**
- `経理データの統合と整理`
- `バグ修正: main.pyのループ処理`

---

## 6. プロジェクト管理とコンテキスト注入 (Project Dashboard & Context)

各プロジェクトフォルダ（`30_Projects/xxx/`）直下にある `README.md` は、その案件の**最重要管理ファイル**である。


### ◆ コンテキスト注入の絶対ルール (Context Injection)

AIがいかなるタスクを実行する場合も、**以下のプロセスを自動的に実行すること。**

1. **README確認:** 作業開始前に、必ず現在のプロジェクト直下にある `README.md` を読み込む。
2. **ルールの統合:** `99_System` にある汎用的なプロンプトを実行する際も、README内に書かれた**「固有ルール（ターゲット、配色、NGワード）」**を優先的に適用（上書き）する。
3. **禁止事項:** READMEを確認せずに、「一般的な回答」や「当たり障りのないコード」を出力することを禁止する。

**【AIへの思考ガイド】**
> 「このプロンプトは汎用版だが、今は『Web案件A』の中にいる。だからREADMEに書いてある『赤色禁止』というルールを適用してコードを書こう」

### ◆ プロジェクト必須ファイル (Required Files)

新規プロジェクト作成時、AIは必ず以下のファイルをプロジェクトフォルダ直下に作成すること。

#### 🛡️ 職場プロジェクト作成時のGit確認・自動設定 (Work Git Workflow)

`Company_Work/30_Projects/` に新規プロジェクトを作成する際は、**必ず以下のフローを自動実行すること。**

1. **確認**: 「これは職場のGitHubで管理する案件ですか？（専用のGitリポジトリを作りますか？）」とユーザーに聞く。
2. **Yesの場合**:
   - **Ignore**: ルートの `.gitignore` にプロジェクトパスを追加する。
   - **Init**: プロジェクト内で `git init` を実行する。
   - **Config**: 以下の**職場用クレデンシャル**を自動設定する。（ユーザーに入力させない）
     - `git config user.name "yonetaniweb"`
     - `git config user.email "yonetani.web@gmail.com"`

#### `README.md`（プロジェクトダッシュボード）

| セクション | 内容 |
|------------|------|
| **📋 概要** | プロジェクトの目的、背景、ゴール |
| **🚀 使い方** | ユーザーが実行する手順（コマンド、操作フロー） |
| **💬 AI連携** | Antigravityチャットでの呼び出し方、使用プロンプト例 |

**【例】**
```markdown
# プロジェクト名

## 📋 概要
このプロジェクトは〇〇を自動化するツールです。

## 🚀 使い方
1. `python main.py` を実行
2. 〇〇を確認

## 💬 AI連携（Antigravityチャット）
- 「@README.md このプロジェクトを再開して」
- 「処理状況を確認して」
```

---

## 7. 長時間処理時の状況報告ルール (Status Reporting)

AIが処理を実行する際は、「ユーザーを待たせない」「沈黙しない」ことを最優先に行動すること。

### ◆ 原則: 5分ルールと小分け実行

1. **長時間沈黙の禁止 (NO SILENCE):**
   - 処理が5分以上かかると予想される場合、または5分以上経過した場合は、**必ず一度処理を中断し、ユーザーに状況を報告（`notify_user`）すること**。
   - 「裏で動いています」と言って放置することを厳禁とする。

2. **小分け実行 (INCREMENTAL EXECUTION):**
   - ループ処理（大量ファイルの変換など）を行う際は、**まず「最初の1件」だけを実行して結果を提示すること**。
   - ユーザーがその結果を見て「OK」を出してから、残りの処理を一括実行するフローを徹底すること。
   - いきなり全件実行（例: 50ファイル一括処理）を開始してはならない。

### ◆ 報告テンプレート

```
【確認】長時間処理を開始します
- 対象: 〇〇フォルダ（全53ファイル）
- 予想時間: 20分以上
- リスク: API制限による待機が発生する可能性あり

まずは「最初の1ファイル」だけテスト実行して結果をお見せしますか？
[Yes] 1件テスト実行
[No] 全件一括実行（時間がかかります）
```

---

## 8. プロセス可視化とリカバリー設計 (Process Visibility & Recovery)

AIがスクリプトやツールを作成・実行する際は、ユーザーの「不安」を取り除くため、以下の情報を必ず実装・提示すること。

### ◆ 事前見積もり (Estimation)
処理を開始する前に、以下の情報をユーザーに伝えること。
- **所要時間**: 「約10分」「1時間以上」など目安を提示。
- **制約事項**: APIレート制限（例: 15回/分）、コスト、リスク。

### ◆ 中断と再開 (Resumability)
長時間の処理を行うスクリプトは、**必ず「中断可能」かつ「続きから再開可能（Resume機能）」** に設計すること。
- **進捗保存**: 処理済みリスト（log/json）を保存し、次回起動時にスキップする機能を実装する。
- **再開方法**: 「途中で止めても `python main.py` を再実行すれば続きから始まります」と明示する。
- **冪等性**: 何度実行しても結果が変わらない（重複データを作らない）設計にする。

### ◆ ユーザーアクションの明示 (User Action Required)
処理実行中、ユーザーがどうすべきかを明確に指示すること。
- **PCの状態**: 「処理完了までPCの電源を入れたままにしてください（スリープ不可）」
- **操作**: 「バックグラウンドで動くので、他の作業をしていても構いません」
- **完了後**: 「終わったら通知（またはログ表示）します」

### ◆ 完了・検証報告 (Verification)
処理完了時には、以下の3点を報告すること。
1.  **実績**: 「全50件中、50件成功」
2.  **保存先**: 「成果物は `data/` に保存されました」
3.  **検証**: 「抜け漏れがないか確認するには `verify.py` を実行してください」

---

## 9. 定期監視とセルフヒーリング (Periodic Monitoring & Self-Healing)

長時間のバックグラウンド処理を実行する場合、以下のルールを必ず適用すること。

### ◆ セルフヒーリング設計 (Self-Healing)
- **絶対に止まらない**: APIエラー、レート制限、ネットワーク障害があっても自動リトライし、処理を継続する設計にすること。
- **ラッパースクリプト**: メインスクリプトが異常終了しても自動再起動する「ラッパー」（例: `run_forever.py`）を用意する。
- **無限ループ防止**: 短時間で連続終了した場合は待機時間を長くする（指数バックオフ）。

### ◆ 定期監視 (Periodic Check-In)
ユーザーが放置している間も、AIは以下のタイミングで**自主的に**状況を確認・報告すること。
- **監視間隔**: 1〜2時間ごと（処理内容に応じて調整）
- **報告内容**:
  - プロセスが動いているか（`Get-Process`）
  - 進捗（完了件数 / 全体件数）
  - 異常があれば自動対処（再起動など）
- **報告方法**: ユーザーへのメッセージ、またはログファイルへの記録

### ◆ 実装例
```python
# run_forever.py - 自動再起動ラッパー
while True:
    exit_code = run_main_script()
    if exit_code != 0:
        log("Script crashed, restarting in 60s...")
        time.sleep(60)
```

---

## 10. スキルの命名規則 (Skill Naming Convention)

AIスキル（`.agent/skills/`）を作成する際は、以下の命名規則に従うこと。

### ◆ フォルダ名の形式

```
{案件名}_{スキル種別}
```

- **案件名**: プロジェクト名やサービス名（英語、スネークケース）
- **スキル種別**: 何をするスキルかを示す名詞（英語、スネークケース）

**例:**
| フォルダ名 | 意味 |
|------------|------|
| `auto_accounting_bookkeeper` | 自動経理の記帳スキル |
| `blog_automation_generator` | ブログ自動生成スキル |
| `nippatech_seo_writer` | nippatechのSEOライティングスキル |

### ◆ SKILL.md のフロントマター必須項目

```yaml
---
name: auto_accounting_bookkeeper
description: レシート画像をOCR解析し、CSVに記帳する自動経理スキル
---
```

### ◆ ダッシュボード更新義務

スキルを追加・削除した場合、**必ず `.agent/skills/README.md` のスキル一覧表も更新すること。**

---

## 10.5 共有テンプレート運用ルール (Shared Template Management)

職場（Company_Work）と個人（Private_Life）の両方で共通利用するテンプレート（Remotion等）は、以下のルールに従って管理すること。

### ◆ 保存場所

共有テンプレートは `Private_Life/20_Knowledge_Base/` 配下に配置する。

```
Private_Life/20_Knowledge_Base/remotion_templates/
├── README.md       ← ダッシュボード（テンプレート一覧・使い方）
├── community/      ← ネット上の公開テンプレート
└── custom/         ← 自分で作成したオリジナルテンプレート
```

### ◆ なぜ Private_Life に置くか

- テンプレートはユーザー個人の知的資産（秘伝のタレ）である。
- 職場で使う際は §2 のクロスオーバールールに準拠し、「知識の参照（コピー）」としてアクセスする。
- 会社を辞めても、テンプレート資産はユーザーの手元に残る。

### ◆ 運用フロー

1. **発見・作成**: テンプレートを見つける or 自作する
2. **登録**: `community/` または `custom/` に保存し、`README.md` の一覧表を更新する
3. **利用**: 案件が来たらテンプレートを**コピー**して使う
   - 職場案件 → `Company_Work/30_Projects/案件名/` にコピー
   - 個人案件 → `Private_Life/30_Projects/案件名/` にコピー
4. **カスタマイズ**: コピー先で自由に編集する（**元テンプレートは変更しない**）

### ◆ 禁止事項

- **元テンプレートの直接編集禁止**: テンプレート庫のファイルを案件用に書き換えてはならない。
- **ライセンス無視禁止**: 特にコミュニティ製テンプレートは商用利用可否を必ず確認すること。

### ◆ 新しいテンプレートカテゴリの追加

Remotion以外にも共通テンプレートが必要になった場合は、同じ `20_Knowledge_Base/` 配下に `{ツール名}_templates/` フォルダを作成し、同じ運用ルールを適用すること。

---

## 11. ルール提案の義務 (Rule Proposal Obligation)

AIがタスクを実行する中で、**「これはルールとして定義すべきだ」** と判断した事項（命名規則、禁止事項、運用フローなど）を発見した場合、以下のアクションを取ること。

1. タスク完了時（または適切なタイミング）に、ユーザーに対して以下のように確認する:
   > 「〇〇の件ですが、今後のためにルール（`AI_INSTRUCTIONS.md`）に追記しますか？」
2. ユーザーが承認した場合のみ、`AI_INSTRUCTIONS.md` に追記する。
3. 勝手にルールを追加・変更することは禁止する。

---

## 12. ワークフロー提案の義務 (Workflow Proposal Obligation)

AIが**繰り返し実行される可能性のある作業**（スクリプト実行、定型処理、デプロイなど）を完了した場合、以下のアクションを取ること。

1. タスク完了時に、ユーザーに対して以下のように確認する:
   > 「この一連の作業をワークフロー（`.agent/workflows/`）として保存しますか？ また、このワークフローは職場（Company）用ですか、プライベート（Private）用ですか？」
2. ユーザーが承認した場合:
   - `.agent/workflows/` にAntigravity用のワークフローファイルを作成する。
   - 必要であれば、対応する領域の `99_System/Workflows/` にも人間向け手順書を作成する。
3. ワークフローファイルには `// turbo-all` アノテーションの要否もユーザーに確認すること。

### ◆ ダッシュボード更新義務

ワークフローを追加・削除した場合、**必ず `.agent/workflows/README.md` のワークフロー一覧表も更新すること。**

---

## 13. ナレッジ伝承ルール (Knowledge Transfer Playbook)

Antigravityで構築した仕組みを他の人に伝承するためのマニュアルを管理する。

### ◆ 保存先

`Knowledge_Base/antigravity_playbook/` （または `20_Knowledge_Base/antigravity_playbook/`）

### ◆ トリガー（いつ作成するか）

以下のいずれかに該当する場合、マニュアルを作成・更新する。

1. **手動トリガー**: ユーザーが「プレイブックに追加して」と指示したとき
2. **AIからの提案**: 新しいスキル・仕組みの構築が完了したとき
   → 「この内容をプレイブックに追加しますか？」と確認する
3. **マイルストーン型**: プロジェクトの大きな節目（初期セットアップ完了、新機能構築完了など）
   → 「プレイブックの更新タイミングです。追加しますか？」と確認する

### ◆ 命名規則

`NN_タイトル.md`（連番＋英語のスネークケース）

**例:**
| ファイル名 | 内容 |
|------------|------|
| `01_github_sync.md` | GitHub同期セットアップ |
| `02_auto_accounting.md` | 経理自動化の使い方 |
| `03_blog_automation.md` | ブログ自動生成の使い方 |

### ◆ マニュアル記述ルール (Template)

**以下の構成テンプレートを厳守すること。**
特に「プロダクト名・案」と「目的」を明記し、読み手が効果（時短など）を即座に理解できるようにする。

#### 1. 記事・マニュアルの構成テンプレート
```markdown
# タイトル（何ができるようになるか）

## 📋 概要
- **プロダクト名・案**: {Product Name}
- **目的**: {Purpose, e.g. 作業時間短縮・効率化}
- **背景**: なぜこれが必要なのか（課題）
- **解決策**: どうやって解決するのか（アプローチ）
- **ゴール**: 読んだ後、どうなれるか（効果）

## 🚀 手順・実装
1. **ステップ1**: 具体的なアクション
2. **ステップ2**: コードやコマンド
   ```bash
   command example
   ```

## 🧩 仕組み・構成（図解）
**言葉だけでなく、構造図（MermaidやASCIIアート）で可視化する。**

```
[入力] --> [処理] --> [出力]
```

## 💡 補足・効果
- **メリット**: AがBになる
- **注意点**: Xに気をつける
```

#### 2. 書き方のポイント
- **1行の文字数**: **35文字以内**を目安に改行する（スマホでも読みやすく）
- **結論ファースト**: 「ダラダラ書かない」。まず結果や結論を述べる。
- **視覚化**:
  - 箇条書きを多用する
  - 構造やフローはコードブロックで図示する

### ◆ README.mdの更新義務

マニュアルを追加した際は、`antigravity_playbook/README.md` のマニュアル一覧表にも追記すること。

---

## 15. Vercelデプロイ運用ルール (Vercel Deployment Workflow)

Vercelを利用したWeb制作案件における、「修正指示」「仮アップ」「本番アップ」のコミュニケーションフローを以下のように定める。

### ◆ 基本フロー
1.  **指示出し**: ユーザーはAntigravityチャット内で修正指示を出す。（Slack連携は使わない）
2.  **作業**: AIはチャット内で修正・質問・対応を行う。
3.  **完了報告**:
    *   **仮アップ**: `git push` をトリガーに、GitHub Actions経由で **Slackへ自動通知** される。
    *   **本番アップ**: ユーザーがFTP等でアップロード作業を行う。**完了報告文面のみ** AIがチャットで作成する。

### ◆ Slack自動通知（仮アップ時）
- **トリガー**: `git push origin main` （または各案件のデプロイブランチへのプッシュ）
- **条件**: Vercelのデプロイステータスが `success` になった時のみ通知。
- **内容**:
  ```text
  【案件名】Project Name
  仮アップが完了しましたので、ご確認お願い致します。
  
  https://project-url.vercel.app/
  ```

### ◆ 本番アップ報告テンプレート（チャット生成用）
ユーザーから「本番アップ報告を作って」と依頼された際は、以下のフォーマットで出力すること。

```markdown
以下の文面をSlack等に貼り付けてご報告ください：

---
【案件名】
本番アップしました。

商品カタログ　https://www.matsuno-i.com/hobby/index.html
取扱商品　　　https://www.matsuno-i.com/hobby/products.html
季節商品　　　https://www.matsuno-i.com/hobby/season.html

※もし更新が反映されていない場合は、「Ctrl」＋「F5」キーでページの再読み込みをお試しください。
---
```
